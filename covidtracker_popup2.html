<!--covid tracker map popup 14 day incidence rate per 100k-->

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.19/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.19/"></script>
</head>
<body>
    <div id="mapview" style="width:750px;height:750px;"></div>
    <script>
        let map1;
        let mapView;
        let url = "";
        let featureLayer = "";
        require(["esri/Map", "esri/layers/FeatureLayer", "esri/views/MapView", "esri/widgets/Legend", "esri/request"],
            function (Map, FeatureLayer, MapView, Legend, esriRequest) {

                map1 = new Map({ basemap: "streets" });

                let viewOptions = {
                    container: "mapview", map: map1,
                    center: [-6.24827, 53.34807], //DUBLIN
                    zoom: 11
                }

                //render map
                mapView = new MapView(viewOptions);

                //render legend
                let legend = new Legend({ view: mapView });
                mapView.ui.add(legend, "bottom-right");


                let templatetitle = "Adare-rathkeale LEA-6: 14 Day Incidence of confirmed COVID-19 cases by LEA"

                let templatecontent ="<p><h3>LEA:</h3>";
                templatecontent = templatecontent + "{ENGLISH}</p>";

                templatecontent = templatecontent + "<p>COVID-19 - 14 Day Profile<br>";
                templatecontent = templatecontent + "----<br>";
                templatecontent = templatecontent + "<br>";
                templatecontent = templatecontent + "Confirmed Cases in LEA: {C19_P14_T}<br>";
                templatecontent = templatecontent + "LEA rate per 100k pop: {P14_100k}<br>";
                templatecontent = templatecontent + "R.of Ireland rate per 100k: {Ire_IncP14}</p>";

                templatecontent = templatecontent + "<p>Total Population of {ENGLISH} : {Pop2016}</p>";

                 
                let template = {
                    // autocasts as new PopupTemplate()
                    title: templatetitle,
                    content: templatecontent,
                };

                featureLayer = new FeatureLayer({
                    url: "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/arcgis/rest/services/COVID19_14_Day_Incidence_Rate_per_100k_LEA/FeatureServer/0?f=pjson",
                    outFields: ["*"],
                    popupTemplate: template
                });

                map1.add(featureLayer);

                //set scale such that all data points are visible
                featureLayer.when(function () {
                    mapView.goTo(featureLayer.fullExtent);
                })
            });
    </script>
</body>
</html>