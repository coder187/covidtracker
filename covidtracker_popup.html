<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.19/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.19/"></script>
</head>
<body>
    <div id="mapview" style="width:750px;height:750px;"></div>
        <script>
            let map1;
            let mapView;
            let url = "";
            let featureLayer = "";
            require(["esri/Map", "esri/layers/FeatureLayer", "esri/views/MapView", "esri/geometry/geometryEngine", "esri/request"],
                function (Map, FeatureLayer, MapView, geometryEngine, esriRequest) {

                    map1 = new Map({ basemap: "streets" });

                    let viewOptions = {
                        container: "mapview", map: map1,
                        center: [-117.08, 34.1],
                        zoom: 11
                        }

                //render map
                mapView = new MapView(viewOptions);

                let measureThisAction = {
                    title: "Measure Length",
                    id: "measure-this",
                    image: "https://developers.arcgis.com/javascript/latest/sample-code/popup-actions/live/Measure_Distance16.png"
                    };

                let template = {
                    // autocasts as new PopupTemplate()
                    title: "Trail run",
                    content: "{name}",
                    actions: [measureThisAction]
                    };

                featureLayer = new FeatureLayer({
                    url: "https://services.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/TrailRuns/FeatureServer/0",
                    //rl: "https://services.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/TrailRuns/FeatureServer/0?f=pjson" , 
                    outFields: ["*"],
                    popupTemplate: template
                });

                map1.add(featureLayer);

                // Execute each time the "Measure Length" is clicked
                function measureThis() {
                    var geom = mapView.popup.selectedFeature.geometry;
                    var distance = geometryEngine.geodesicLength(geom, "miles");
                    distance = parseFloat(Math.round(distance * 100) / 100).toFixed(2);
                    mapView.popup.content =
                        mapView.popup.selectedFeature.attributes.name +
                        "<div style='background-color:DarkGray;color:white'>" +
                        distance +
                        " miles.</div>";
                }

                // Event handler that fires each time an action is clicked.
                mapView.popup.on("trigger-action", function (event) {
                    // Execute the measureThis() function if the measure-this action is clicked
                    if (event.action.id === "measure-this") {
                        measureThis();
                    }
                });

            });
        </script>
</body>
</html>