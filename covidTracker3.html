
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Covid Tracker</title>


    <link rel="stylesheet" href="https://js.arcgis.com/4.19/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.19/"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">

    <link rel="stylesheet" href="assets/css/style.css">
    <script src="assets/js/main.js"></script>




</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <div class="pagetitle">Title</div>
            </div>
        </div>
        <div class="row">
            <div class="col md-4">
                <div class="total-cases">
                    Total Cases<br />
                    <span id="Total"><img src="assets/gif/loading.gif" alt="loading"/></span>
                </div>
                <div class="cases-latest-reported">
                    <table>
                        <tr>
                            <td>New:</td>
                            <td><span id="Cases"><img src="assets/gif/loading.gif" alt="loading" /></span></td>
                            <td>gify</td>
                        </tr>
                        <tr>
                            <td>Deaths:</td>
                            <td><span id="Deaths"><img src="assets/gif/loading.gif" alt="loading" /></span></td>
                            <td>gify</td>
                        </tr>
                    </table>
                </div>
                <div class="cases-by-county">
                    Cases By County<br />
                    <ul id="county-list"></ul>
                </div>
            </div> <!-- end left col-->
            <div class="col md-4">
                <div id="mapview" style="width:750px;height:750px;"></div> <!-- placing style in file breaks popup-->
            </div> <!-- end center col-->
            <div class="col md-4">
                <div id="legendview"></div>
            </div><!-- end right col-->
        </div>
    </div>
    <script>
        GetCovidStats().then(
            function (message) {
                //console.log("Resolved: ", message);
                PrintCovidStats(message, 0);
            },
            function (error) {
                console.log("Rejected: ", error);
                PrintCovidStats(message, 1);
            }
        );

        function PrintCovidStats(stats, err) {
            if (err !== 0) {
                document.getElementById("Deaths").innerHTML = "?";
                document.getElementById("Cases").innerHTML = "?";
                document.getElementById("Total").innerHTML = "?";
            }
            else {
                document.getElementById("Deaths").innerHTML = stats.Deaths;
                document.getElementById("Cases").innerHTML = stats.Cases;
                document.getElementById("Total").innerHTML = stats.TotalCases;
            }

        }

    </script>

    <script>
        GetCountyStats()
    </script>

       
    
    <script>
        //render main map
        let map1;
        let mapView;
        let url = "";
        let featureLayer = "";
        require(["esri/Map", "esri/layers/FeatureLayer", "esri/views/MapView", "esri/widgets/Legend", "esri/request"],
            function (Map, FeatureLayer, MapView, Legend, esriRequest) {

                map1 = new Map({ basemap: "streets" });

                let viewOptions = {
                    container: "mapview", map: map1,
                    center: [-7.912130968565811,53.096755475713266], // Birr
                    zoom: 7 
                }

                //render map
                mapView = new MapView(viewOptions);

                //render legend
                let legend = new Legend({ view: mapView }, "legendview");
                // mapView.ui.add(legend, "top-right"); legend is rendered outside map in the legendview


                let templatetitle = "Adare-rathkeale LEA-6: 14 Day Incidence of confirmed COVID-19 cases by LEA"

                let templatecontent ="<p><h3>LEA:</h3>";
                templatecontent = templatecontent + "{ENGLISH}</p>";

                templatecontent = templatecontent + "<p>COVID-19 - 14 Day Profile<br>";
                templatecontent = templatecontent + "----<br>";
                templatecontent = templatecontent + "<br>";
                templatecontent = templatecontent + "Confirmed Cases in LEA: {C19_P14_T}<br>";
                templatecontent = templatecontent + "LEA rate per 100k pop: {P14_100k}<br>";
                templatecontent = templatecontent + "R.of Ireland rate per 100k: {Ire_IncP14}</p>";

                templatecontent = templatecontent + "<p>Total Population of {ENGLISH} : {Pop2016}</p>";

                 
                let template = {
                    // autocasts as new PopupTemplate()
                    title: templatetitle,
                    content: templatecontent,
                };

                featureLayer = new FeatureLayer({
                    url: "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/arcgis/rest/services/COVID19_14_Day_Incidence_Rate_per_100k_LEA/FeatureServer/0?f=pjson",
                    outFields: ["*"],
                    popupTemplate: template
                });

                map1.add(featureLayer);

                //set scale such that all data points are visible
                featureLayer.when(function () {
                   mapView.goTo(featureLayer.fullExtent);
                })
            });
    </script>
</body>
</html>