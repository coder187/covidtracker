<!--COVID TRACKER-->
<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>IGeometry-Head</title>

    <link rel="stylesheet" href="https://js.arcgis.com/4.19/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.19/"></script>
</head>
<body>
    <button id="mapSelect">Toggle Maps</button>
    <select id="lstcounty"></select>
    <div id="mapview" style="width:1000px;height:1000px;">my map</div>

    <script>
        let map1;
        let mapView;


        //NOTE CANNOT HAVE SceneView & request together - an undefined error is thrown when calling the request
        //require(["esri/Map", "esri/views/MapView", "esri/views/SceneView", "esri/request","esri/layers/MapImageLayer" ],
        require(["esri/Map", "esri/views/MapView", "esri/request", "esri/layers/MapImageLayer", "esri/layers/FeatureLayer", "esri/widgets/Legend"],
            function (Map, MapView, esriRequest, MapLayer, FeatureLayer,Legend) {
          
                map1 = new Map({ basemap: "streets" });

                let viewOptions = {
                    container: "mapview", map: map1,
                    center: [-6.24827, 53.34807], //DUBLIN
                    scale: 10000
                }


                //render map
                mapView = new MapView(viewOptions);

                //render legend
                let legend = new Legend({ view: mapView });
                mapView.ui.add(legend, "bottom-right");

                //url for endpoint data host
                let url = "https://services1.arcgis.com/eNO7HHeQ3rUcBllm/arcgis/rest/services/Covid19CountyStatisticsHPSCIreland/FeatureServer/0?f=json"
                //https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/arcgis/rest/services/COVID19_14_Day_Incidence_Rate_per_100k_LEA/FeatureServer/0?f=pjson
                
                //url = "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/ArcGIS/rest/services/Covid19_Acute_Hospital_Current_List_Date_View/FeatureServer/layers?f=pjson"; //hospital list
                //url = "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/ArcGIS/rest/services/Covid19Acute_HospitalCurrentListSummarisedPublicView/FeatureServer?f=pjson";// current list summarised
                //url = "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/ArcGIS/rest/services/Covid19Acute_HospitalCurrentListSummarisedPublicView/FeatureServer/0?f=pjson";

               
                url = "https://services1.arcgis.com/eNO7HHeQ3rUcBllm/arcgis/rest/services/Covid19CountyStatisticsHPSCIrelandOpenData/FeatureServer/0?f=pjson";
                url = "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/arcgis/rest/services/COVID19_14_Day_Incidence_Rate_per_100k_LEA/FeatureServer/0?f=pjson" //COVID 19 14 DAY INCIDENCE RATE PER 100K PER LOCAL ELECTORAL AREA https://data.gov.ie/dataset/covid19-leacases-mapped2
                url = "https://services1.arcgis.com/eNO7HHeQ3rUcBllm/arcgis/rest/services/Covid19CountyStatisticsHPSCIreland/FeatureServer/0?f=pjso";
                url = "https://services1.arcgis.com/eNO7HHeQ3rUcBllm/ArcGIS/rest/services?f=pjson"
                url = "https://services1.arcgis.com/eNO7HHeQ3rUcBllm/ArcGIS/rest/services/NTA/FeatureServer?f=pjson" //ntA nitelink stops
                url = "https://services1.arcgis.com/eNO7HHeQ3rUcBllm/ArcGIS/rest/services/PRTB_2015/FeatureServer?f=pjson" //PRTB 2015 - Rental Property Prices, RTB 2015
                url = "https://services1.arcgis.com/eNO7HHeQ3rUcBllm/ArcGIS/rest/services/PRTB_2015/FeatureServer?f=pjson" //PRTB 2015 - Rental Property Prices, RTB 2015
                url = "https://services1.arcgis.com/eNO7HHeQ3rUcBllm/ArcGIS/rest/services/Covid19CountyStatisticsHPSCIreland/FeatureServer?f=pjson" //CovidCountyStatisticsHPSCIreland - all the same color?
                url = "https://services1.arcgis.com/eNO7HHeQ3rUcBllm/ArcGIS/rest/services/Covid19CountyStatisticsHPSCIrelandOpenData/FeatureServer?f=pjson" //Covid19CountyStatisticsHPSCIrelandOpenData
                url = "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/arcgis/rest/services/COVID19_14_Day_Incidence_Rate_per_100k_LEA/FeatureServer/0/query?where=GUID+%3D+%272ae19629-3f1b-13a3-e055-000000000001%27&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=html&token="
                url = "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/arcgis/rest/services/COVID19_14_Day_Incidence_Rate_per_100k_LEA/FeatureServer/0/query?outFields=*&where=GUID+%3D+%272ae19629-3f1b-13a3-e055-000000000001&f=geojson" //COVID19 14 Day Incidence Rate per 100k LEA - LEA2018 MapFile
                url = "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/arcgis/rest/services/COVID19_14_Day_Incidence_Rate_per_100k_LEA/FeatureServer/0/query?outFields=*&where=COUNTY%3D%27MEATH%27&f=geojson"
                url = "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/arcgis/rest/services/COVID19_14_Day_Incidence_Rate_per_100k_LEA/FeatureServer/0/query?outFields=*&where=COUNTY%3D%27LIMERICK%27&f=geojson"

                url = "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/arcgis/rest/services/COVID19_14_Day_Incidence_Rate_per_100k_LEA/FeatureServer/0/query?outFields=*&where=Pop2016>1&f=geojson"
                let whereClause = "Pop2016>1"
                url = "https://services-eu1.arcgis.com/z6bHNio59iTqqSUY/arcgis/rest/services/COVID19_14_Day_Incidence_Rate_per_100k_LEA/FeatureServer/0/query?outFields=*&where=" + whereClause + "&f=geojson"

                
                //set response type (json/xml/text/document and set query statement)
                var options = {
                    
                    responseType: "json"
                };

                console.log("about to create promise");

                //pull data from endpoint
                esriRequest(url, options).then(function (response) {
                    console.log("response", response);
                    //console.log(response.data.currentVersion);
                    //let myFields=[];
                    //myFields = response.data.fields;
                    //for (let i = 0; i <= myFields.length; i++) {
                    //    console.log(myFields[i]);
                    //}

                    let myFeatures = [];
                    let myProp = {};
                    let myCounty = [];

                    myFeatures = response.data.features;
                    for (let i = 0; i < myFeatures.length; i++) {
                        //console.log(myFeatures[i]);
                        myProp = response.data.features[i].properties;
                        //console.log(myProp.COUNTY + "/" + myProp.ENGLISH + "/" + myProp.Pop2016 + "/" + myProp.P14_100k);
                        if (myCounty.indexOf(myProp.COUNTY) === -1) {
                            myCounty.push(myProp.COUNTY);
                        }

                    }



                    //creatw new layer containing the geo spatial data
                    var layer = new FeatureLayer({
                        url: url
                    });

                    //add the layer to he map
                    //let layer = new MapLayer({ url: url })
                    map1.add(layer);

                    //set scale such that all data points are visible
                    layer.when(function () {
                        mapView.goTo(layer.fullExtent);
                    })
                        
                    let lstCounty = document.getElementById("lstcounty");
                    for (let x = 0; x < myCounty.length; x++) {
                        console.log(myCounty[x]);
                        let option = document.createElement("option");
                        option.text = myCounty[x];
                        lstCounty.add(option);
                    }

                    lstCounty.addEventListener("change", function () {
                        let selectedCounty = lstCounty.options[lstCounty.selectedIndex].textContent;
                        alert(selectedCounty);
                    })

                });

                                
            }
        );

       
    </script>

</body>
</html>